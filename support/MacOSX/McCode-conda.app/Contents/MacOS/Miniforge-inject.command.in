#!@SHEBANG@
#
# Script for downloading and injecting dependencies using a fresh Miniforge
#

BASEDIR=`dirname $0`
BASEDIR=$BASEDIR/../..

osascript -e "tell app \"System Events\" to display dialog \"Will download inject dependencies using latest Miniforge :-) \"" 

(cd /tmp && curl -L -O https://raw.githubusercontent.com/willend/McCode/main/@FLAVOR@-environment.yml)
(cd /tmp && curl -L -O "https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-$(uname)-$(uname -m).sh")
bash /tmp/Miniforge3-$(uname)-$(uname -m).sh -p ${BASEDIR}/Contents/Resources/miniforge3/ -b
eval "$(${BASEDIR}/Contents/Resources/miniforge3/bin/conda shell.bash hook)"
conda env update --file /tmp/@FLAVOR@-environment.yml

osascript -e "tell app \"System Events\" to display dialog \"Your @FLAVOR@ should now contain the necessary dependencies! :-) \""
