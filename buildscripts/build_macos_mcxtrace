#!/usr/bin/env bash
export CMAKE_BUILD_PARALLEL_LEVEL=${CMAKE_BUILD_PARALLEL_LEVEL:-$(python3 -c "import os;print(os.cpu_count())")}

if [ "x$1" = "x" ]; then
    # No version arg
    echo Please provide a version argument,e.g : $0 2.0
    exit 1;
fi


export MCVERSION=${1}

cmake --build build-arm64 -s support/MacOSX/McCode-conda.app -DBUILD_MCXTRACE=ON -DMCVERSION=${MCVERSION} -DARCH_ENABLE=arm64 -DCMAKE_INSTALL_PREFIX=dist-arm64/McXtrace-${MCVERSION}.app
cmake --build build-arm64 --config Release
cmake --build build-arm64 --target install --config Release

cmake --build build-x84_64 support/MacOSX/McCode-conda.app -DBUILD_MCXTRACE=ON -DMCVERSION=${MCVERSION} -DARCH_ENABLE=x84_64 -DCMAKE_INSTALL_PREFIX=dist-x84_64/McXtrace-${MCVERSION}.app
cmake --build build-x84_64 --config Release
cmake --build build-x84_64 --target install --config Release
